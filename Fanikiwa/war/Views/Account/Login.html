﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿
<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Fanikiwa - Peer-to-Peer Lending</title>
<link href="/Images/Dollar.ico" rel="shortcut icon" type="image/x-icon" />
<link rel="stylesheet" href="/Content/Site.css" type="text/css" />
<script src="/Scripts/jquery-2.0.3.js" type="text/javascript"></script>
<script src="/Scripts/CustomScripts.js" type="text/javascript"></script>


</head>


<body>

	<header>
		<div class="content-wrapper">

			<div class="float-left">
				<p class="site-title" title="Fanikiwa - Peer - To - Peer Lending">
					Fanikiwa - Peer - To - Peer Lending</p>
			</div>


			<div class="float-right">
				<section id="login">
					<text> Welcome To Fanikiwa</text>
				</section>
			</div>






		</div>


	</header>




	<div id="body">


		<section class="content-wrapper main-content clear-fix">

			<div id="error-display-div" class="displaynone"></div>


			<hgroup class="title">
				<h2 class="page-title">Login</h2>
			</hgroup>

			<form action="javascript:void(0);">

				<fieldset>
					<legend>Login</legend>

					<article class="col1">
						<div class="pad">

							<div>
								<label for="txtEmail">Email</label> <input id="txtEmail"
									placeholder="Email" autofocus="autofocus" type="text"></input>
							</div>

							<div>
								<label for="txtPassword">Password</label> <input
									id="txtPassword" placeholder="Password" type="password"></input>
							</div>


						</div>
					</article>


					<div style="float: left; clear: both">
						<input type="submit" value="Login" id="btnLogin" disabled /> Not
						Registered Click <a id="btnRegisterForm"
							href="/Views/Account/Register.html" style="cursor: pointer;">Here
						</a> To Register
					</div>


<!-- 					<div style="float: left; clear: both"> -->
<!-- 						<input type="submit" value="SMSTest" id="btnSMSTest" /> <input -->
<!-- 							type="submit" value="MpesaTest" id="btnMpesaTest" /> -->
<!-- 					</div> -->



				</fieldset>


			</form>


		</section>


	</div>




	<footer>

		<hr />

		<div class="content-wrapper clearboth">
			<div class="float-left">
				<p style="font-size: 15px">Copyright &copy; Software Providers
					Limited. All Rights Reserved.</p>
			</div>
		</div>


		<div class="content-wrapper clearboth">
			<div></div>
		</div>


	</footer>





	<script type="text/javascript">
	
		document.getElementById('btnLogin').onclick = function() {
			Login();
		}  
		
// 		document.getElementById('btnSMSTest').onclick = function() {
// 			window.location.href = "/Views/Test/SMSTest.html";
// 		}

// 		document.getElementById('btnMpesaTest').onclick = function() {
// 			window.location.href = "/Views/Test/MpesaTest.html";
// 		}

		var errormsg = '';
		errormsg += '<ul id="errorList">';

		function init() {

			// Parameters are APIName,APIVersion,CallBack function,API Root
			gapi.client.load('userprofileendpoint', 'v1', function() {
				enableButton();
			}, ROOT);

		}

		function enableButton() {
			$("input[type=submit]").removeAttr("disabled");
		}

		function Login() {

			errormsg = '';
			ClearException();
			errormsg += '<ul id="errorList">';
			var error_free = true;

			// Validate the entries
			var _Email = document.getElementById('txtEmail').value;
			var _Password = document.getElementById('txtPassword').value;

			if (_Email.length == 0) {
				errormsg += '<li>' + " Email cannot be null " + '</li>';
				error_free = false;
			}
			if (_Password.length == 0) {
				errormsg += '<li>' + " Password cannot be null " + '</li>';
				error_free = false;
			}

			if (!error_free) {
				errormsg += "</ul>";
				$("#error-display-div").html(errormsg);
				$("#error-display-div").removeClass('displaynone');
				$("#error-display-div").addClass('displayblock');
				$("#error-display-div").show();
				return;
			} else {
				ClearException();
			}

			// Build the Request Object
			var login = {};
			login.userId = _Email;
			login.pwd = _Password;

			loginNow(login);
		}

		function loginNow(login) {

			var request = gapi.client.userprofileendpoint
					.login(login)
					.then(
							function(response) {
								console.log(response);
								localStorage.loggedinuser = response.result.userId;
								window.location.href = "/Views/Home/Index.html";
							},
							function(reason) {
								console.log('Error: '
										+ reason.result.error.message);
								document.getElementById('txtEmail').value = '';
								document.getElementById('txtPassword').value = '';
								alert("Authentication failed check your Email and Password...");
								return;
							});
		}

		function DisplayException(errormsg) {

			errormsg += "</ul>";

			$("#error-display-div").html(errormsg);
			$("#error-display-div").removeClass('displaynone');
			$("#error-display-div").addClass('displayblock');
			$("#error-display-div").show();
		}

		function ClearException() {
			$('#errorList').remove();
			$('#error-display-div').empty();
		}
	</script>

	<script src="https://apis.google.com/js/client.js?onload=init"></script>






</body>


</html>
